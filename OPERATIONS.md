# Text2SQL 서버 운영 가이드

> **서버 정보**
> | 항목 | 값 |
> |------|-----|
> | IP 주소 | `192.168.10.40` |
> | 운영체제 | Rocky Linux 9.6 |
> | GPU | NVIDIA H100 NVL x 5장 (GPU 0-3: gpt-oss-120b, GPU 4: Qwen3-Coder) |
> | 사용자 | `root` |
> | Conda 환경 | `text2sql` (Gradio 앱), `py312_sr` (vLLM) |
> | 웹 UI | http://192.168.10.40:7860 |
> | vLLM API (GPT-OSS) | http://192.168.10.40:8000/v1 |
> | vLLM API (Qwen3-Coder) | http://192.168.10.40:8001/v1 |

> **이 문서의 대상:** Linux 명령어를 전혀 모르는 개발자를 위해 작성되었습니다.
> 모든 명령어에는 한글 설명, 사용 시점, 주의사항이 포함되어 있습니다.

---

## 목차

1. [SSH 접속 방법](#1-ssh-접속-방법)
2. [GPU 상태 확인](#2-gpu-상태-확인)
3. [서비스 관리 명령어](#3-서비스-관리-명령어)
4. [Conda 환경 관리](#4-conda-환경-관리)
5. [파일 수정 방법](#5-파일-수정-방법)
6. [vLLM 모델 관리](#6-vllm-모델-관리)
7. [방화벽 관리](#7-방화벽-관리)
8. [서버에 파일 업로드/다운로드](#8-서버에-파일-업로드다운로드)
9. [시스템 리소스 확인](#9-시스템-리소스-확인)
10. [문제 해결 (트러블슈팅)](#10-문제-해결-트러블슈팅)
11. [전체 시스템 재시작 순서](#11-전체-시스템-재시작-순서)

---

## 1. SSH 접속 방법

> **SSH란?** 원격 서버에 접속하기 위한 프로토콜입니다.
> Windows의 터미널(PowerShell, Windows Terminal, CMD)에서 아래 명령어를 실행하면
> Linux 서버에 접속하여 명령어를 입력할 수 있습니다.

### 서버 접속

```bash
ssh root@192.168.10.40
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | Windows에서 Linux 서버(192.168.10.40)에 `root` 사용자로 원격 접속합니다. |
| **언제 사용하는지** | 서버에서 작업이 필요할 때 항상 가장 먼저 실행합니다. |
| **주의사항** | SSH 키 인증이 설정되어 있으므로 별도의 비밀번호 입력은 필요하지 않습니다. 만약 "Connection refused" 오류가 뜨면 서버가 꺼져 있거나 네트워크에 문제가 있는 것입니다. |

### 접속 종료

```bash
exit
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | 현재 SSH 세션을 종료하고 내 컴퓨터로 돌아옵니다. |
| **언제 사용하는지** | 서버 작업을 모두 마쳤을 때 사용합니다. |

---

## 2. GPU 상태 확인

> **왜 GPU 상태를 확인하나요?** 이 서버는 H100 GPU 5장으로 LLM 모델을 돌립니다.
> GPU 메모리가 부족하거나 온도가 너무 높으면 모델이 정상 동작하지 않을 수 있습니다.

### GPU 현재 상태 확인

```bash
nvidia-smi
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | 모든 GPU의 사용량, 온도, 메모리 사용량, 실행 중인 프로세스를 한눈에 보여줍니다. |
| **언제 사용하는지** | 모델이 느리거나 응답이 없을 때, 또는 GPU 상태를 점검하고 싶을 때 사용합니다. |
| **주의사항** | 이 명령은 한 번 실행하면 결과를 한 번만 보여주고 끝납니다. |

**출력 화면 읽는 법:**

```
+----------------------------+
| GPU  Name        Temp  ... |   <-- GPU 이름과 온도
| Fan  Util  Memory-Usage    |   <-- 팬 속도, GPU 사용률, 메모리 사용량
+----------------------------+
|   0  H100 NVL    45C  ... |   <-- GPU 0 (gpt-oss-120b 용)
|   1  H100 NVL    43C  ... |   <-- GPU 1 (gpt-oss-120b 용)
|   2  H100 NVL    44C  ... |   <-- GPU 2 (gpt-oss-120b 용)
|   3  H100 NVL    42C  ... |   <-- GPU 3 (gpt-oss-120b 용)
|   4  H100 NVL    40C  ... |   <-- GPU 4 (Qwen3-Coder 용)
+----------------------------+
```

- **Temp (온도):** 80도 이상이면 주의가 필요합니다.
- **Memory-Usage (메모리):** 거의 가득 차 있는 것이 정상입니다 (모델이 메모리를 많이 사용).
- **GPU-Util (사용률):** 요청 처리 중이면 올라가고, 대기 중이면 낮습니다.

### GPU 상태 실시간 모니터링

```bash
nvidia-smi -l 2
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | GPU 상태를 2초마다 자동으로 갱신하며 실시간으로 보여줍니다. |
| **언제 사용하는지** | 모델 로딩 중이거나, 부하 테스트 중에 GPU 상태 변화를 계속 지켜보고 싶을 때 사용합니다. |
| **주의사항** | 종료하려면 `Ctrl + C` 키를 누릅니다. `-l` 뒤의 숫자를 바꾸면 갱신 간격(초)을 조절할 수 있습니다. |

---

## 3. 서비스 관리 명령어

> **서비스란?** Linux에서 백그라운드에서 자동으로 실행되는 프로그램을 의미합니다.
> 이 서버에는 3개의 주요 서비스가 있습니다:
>
> | 서비스 이름 | 역할 | 포트 |
> |-------------|------|------|
> | `text2sql-ui` | Gradio 웹 UI (사용자 인터페이스) | 7860 |
> | `vllm` | GPT-OSS-120B 모델 서빙 (GPU 0-3) | 8000 |
> | `vllm-qwen3-coder` | Qwen3-Coder 모델 서빙 (GPU 4) | 8001 |

### 서비스 상태 확인

```bash
systemctl status text2sql-ui
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | `text2sql-ui` 서비스가 현재 실행 중인지, 언제 시작되었는지, 오류가 있는지 보여줍니다. |
| **언제 사용하는지** | 웹 UI가 접속이 안 될 때, 서비스가 정상인지 확인할 때 사용합니다. |
| **주의사항** | `Active: active (running)` 이면 정상, `Active: failed` 또는 `Active: inactive` 이면 문제가 있는 것입니다. |

```bash
systemctl status vllm
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | GPT-OSS-120B 모델 서빙 서비스(vLLM)의 상태를 확인합니다. |
| **언제 사용하는지** | SQL 생성이 안 되거나 모델 응답이 없을 때 확인합니다. |

```bash
systemctl status vllm-qwen3-coder
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | Qwen3-Coder 모델 서빙 서비스의 상태를 확인합니다. |
| **언제 사용하는지** | Qwen3-Coder 모델 응답이 없을 때 확인합니다. |

### 서비스 재시작

```bash
systemctl restart text2sql-ui
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | 웹 UI 서비스를 중지했다가 다시 시작합니다. 설정 파일 변경이 반영됩니다. |
| **언제 사용하는지** | 설정 파일(.env, config.py 등)을 수정한 후, 또는 웹 UI가 먹통일 때 사용합니다. |
| **주의사항** | 재시작 중에는 잠시(약 몇 초) 웹 UI에 접속할 수 없습니다. |

```bash
systemctl restart vllm
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | GPT-OSS-120B vLLM 서비스를 재시작합니다. 모델을 다시 로딩합니다. |
| **언제 사용하는지** | 모델 응답이 비정상적이거나 vLLM이 멈췄을 때 사용합니다. |
| **주의사항** | 모델을 GPU에 다시 로딩하므로 **2~5분 정도** 소요됩니다. 이 시간 동안 SQL 생성이 안 됩니다. |

```bash
systemctl restart vllm-qwen3-coder
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | Qwen3-Coder vLLM 서비스를 재시작합니다. |
| **언제 사용하는지** | Qwen3-Coder 모델이 응답하지 않을 때 사용합니다. |
| **주의사항** | 모델 재로딩에 시간이 소요됩니다. |

### 서비스 중지

```bash
systemctl stop text2sql-ui
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | 웹 UI 서비스를 완전히 중지합니다. |
| **언제 사용하는지** | 서버 점검이나 유지보수를 위해 웹 UI를 내려야 할 때 사용합니다. |
| **주의사항** | 중지 후에는 http://192.168.10.40:7860 에 접속할 수 없습니다. 다시 시작하려면 `systemctl start text2sql-ui`를 실행하세요. |

### 서비스 시작

```bash
systemctl start text2sql-ui
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | 중지되어 있는 웹 UI 서비스를 시작합니다. |
| **언제 사용하는지** | `systemctl stop`으로 서비스를 중지한 후 다시 시작할 때 사용합니다. |

### 서비스 로그 확인

```bash
journalctl -u text2sql-ui -n 50 --no-pager
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | `text2sql-ui` 서비스의 최근 로그 50줄을 화면에 출력합니다. |
| **언제 사용하는지** | 서비스에 오류가 발생했을 때 원인을 파악하기 위해 사용합니다. |
| **주의사항** | `-n 50`의 숫자를 바꾸면 출력할 줄 수를 조절할 수 있습니다. 예: `-n 100`이면 최근 100줄. `--no-pager`는 결과를 한 번에 전부 출력하라는 옵션입니다. |

```bash
journalctl -u vllm -n 50 --no-pager
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | GPT-OSS vLLM 서비스의 최근 로그 50줄을 출력합니다. |
| **언제 사용하는지** | 모델 서빙에 문제가 생겼을 때 오류 메시지를 확인하기 위해 사용합니다. |

```bash
journalctl -u vllm-qwen3-coder -n 50 --no-pager
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | Qwen3-Coder vLLM 서비스의 최근 로그 50줄을 출력합니다. |
| **언제 사용하는지** | Qwen3-Coder 서비스에 문제가 생겼을 때 확인합니다. |

### 서비스 실시간 로그 모니터링

```bash
journalctl -u text2sql-ui -f
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | `text2sql-ui` 서비스의 로그를 실시간으로 보여줍니다. 새 로그가 생길 때마다 자동으로 화면에 추가됩니다. |
| **언제 사용하는지** | 문제를 재현하면서 동시에 로그를 실시간으로 보고 싶을 때 사용합니다. 예를 들어, 웹에서 SQL 생성을 시도하면서 서버 로그를 확인할 때 유용합니다. |
| **주의사항** | 종료하려면 `Ctrl + C` 키를 누릅니다. `-u` 뒤의 서비스 이름을 `vllm` 또는 `vllm-qwen3-coder`로 바꾸면 해당 서비스의 실시간 로그를 볼 수 있습니다. |

---

## 4. Conda 환경 관리

> **Conda란?** Python 패키지와 환경을 관리하는 도구입니다.
> 이 서버에는 두 개의 Conda 환경이 있으며, 각각 다른 용도로 사용됩니다:
>
> | 환경 이름 | 용도 | 설명 |
> |-----------|------|------|
> | `text2sql` | Gradio 앱 | 웹 UI 관련 Python 패키지가 설치됨 |
> | `py312_sr` | vLLM | 모델 서빙 관련 Python 패키지가 설치됨 |

### 환경 활성화

```bash
conda activate text2sql
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | Gradio 앱용 Python 환경(`text2sql`)을 활성화합니다. 활성화되면 프롬프트 앞에 `(text2sql)`이 표시됩니다. |
| **언제 사용하는지** | Gradio 앱 관련 패키지를 설치하거나, Python 스크립트를 직접 실행할 때 사용합니다. |
| **주의사항** | 환경을 활성화하지 않으면 필요한 패키지를 찾지 못해 오류가 발생할 수 있습니다. |

```bash
conda activate py312_sr
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | vLLM용 Python 환경(`py312_sr`)을 활성화합니다. |
| **언제 사용하는지** | vLLM 관련 패키지를 설치하거나 vLLM 설정을 직접 다룰 때 사용합니다. |

### 환경 비활성화

```bash
conda deactivate
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | 현재 활성화된 Conda 환경을 비활성화하고 기본 환경으로 돌아갑니다. |
| **언제 사용하는지** | 다른 Conda 환경으로 전환하기 전이나, 환경 작업을 마쳤을 때 사용합니다. |

### 설치된 패키지 확인

```bash
pip list
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | 현재 활성화된 Conda 환경에 설치된 모든 Python 패키지 목록을 보여줍니다. |
| **언제 사용하는지** | 특정 패키지가 설치되어 있는지, 어떤 버전인지 확인할 때 사용합니다. |
| **주의사항** | 반드시 원하는 Conda 환경을 먼저 활성화한 뒤 실행해야 합니다. 환경마다 설치된 패키지가 다릅니다. |

### 패키지 설치

```bash
pip install 패키지명
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | 현재 활성화된 Conda 환경에 새로운 Python 패키지를 설치합니다. |
| **언제 사용하는지** | 새로운 기능 개발을 위해 추가 패키지가 필요할 때 사용합니다. |
| **주의사항** | 반드시 올바른 Conda 환경이 활성화된 상태에서 설치하세요. 잘못된 환경에 설치하면 의미가 없습니다. 특정 버전을 설치하려면 `pip install 패키지명==버전` 형식을 사용합니다. |

**예시:**
```bash
conda activate text2sql        # 먼저 환경 활성화
pip install requests==2.31.0   # 특정 버전 설치
pip list | grep requests       # 설치 확인 (requests 패키지만 필터링)
```

---

## 5. 파일 수정 방법

> **참고:** Linux 서버에서 파일을 편집할 때는 `nano`라는 텍스트 에디터를 사용합니다.
> Windows의 메모장과 비슷하지만 마우스 대신 키보드로 조작합니다.

### nano 에디터로 파일 편집

```bash
nano /root/text2sql/app/config.py
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | `nano` 텍스트 에디터로 지정한 파일을 엽니다. |
| **언제 사용하는지** | 설정 파일이나 소스 코드를 직접 서버에서 수정해야 할 때 사용합니다. |

**nano 에디터 사용법 (핵심 단축키):**

| 단축키 | 동작 |
|--------|------|
| `Ctrl + O` | 파일 저장 (Save). 누르면 파일명 확인 후 `Enter`를 눌러 저장합니다. |
| `Ctrl + X` | 에디터 종료 (Exit). 저장하지 않았으면 저장 여부를 묻습니다. |
| `Ctrl + K` | 현재 줄 잘라내기 (Cut) |
| `Ctrl + U` | 잘라낸 줄 붙여넣기 (Paste) |
| `Ctrl + W` | 텍스트 검색 (Search). 검색어를 입력하고 `Enter`를 누릅니다. |
| `Ctrl + G` | 도움말 보기 |
| 방향키 (화살표) | 커서 이동 |

### 파일 내용 확인 (읽기 전용)

```bash
cat /root/text2sql/app/config.py
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | 파일의 전체 내용을 화면에 출력합니다. 수정 없이 내용만 확인합니다. |
| **언제 사용하는지** | 파일 내용을 빠르게 확인하고 싶을 때 사용합니다. 수정이 필요 없으면 `nano` 대신 이 명령을 사용하세요. |
| **주의사항** | 파일이 너무 길면 화면이 스크롤됩니다. 긴 파일은 `less /root/text2sql/app/config.py`를 사용하면 페이지 단위로 볼 수 있습니다. (`q` 키로 종료) |

### 비밀번호 변경

```bash
nano /root/text2sql/.env
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | `.env` 환경 변수 파일을 편집합니다. 이 파일에 Gradio 웹 UI의 비밀번호가 저장되어 있습니다. |
| **언제 사용하는지** | 웹 UI 로그인 비밀번호를 변경해야 할 때 사용합니다. |

**변경 순서:**

1. `nano /root/text2sql/.env` 실행
2. `GRADIO_PASSWORD=` 부분을 찾아서 `=` 뒤의 값을 새 비밀번호로 변경
   ```
   GRADIO_PASSWORD=새비밀번호
   ```
3. `Ctrl + O` -> `Enter` (저장)
4. `Ctrl + X` (에디터 종료)
5. 서비스 재시작 (변경 사항 반영):
   ```bash
   systemctl restart text2sql-ui
   ```

> **주의:** `.env` 파일 수정 후 반드시 서비스를 재시작해야 변경 사항이 적용됩니다!

---

## 6. vLLM 모델 관리

> **vLLM이란?** 대규모 언어 모델(LLM)을 빠르게 서빙하기 위한 엔진입니다.
> 이 서버에서는 두 개의 vLLM 인스턴스가 각각 다른 모델을 서빙하고 있습니다.

### 현재 서빙 중인 모델 확인

```bash
curl http://localhost:8000/v1/models
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | GPT-OSS-120B 모델 서버(포트 8000)에 어떤 모델이 서빙되고 있는지 확인합니다. |
| **언제 사용하는지** | vLLM 서비스가 정상적으로 시작되었는지 확인할 때 사용합니다. 모델 로딩이 완료되어야 응답이 옵니다. |
| **주의사항** | "Connection refused" 오류가 나오면 vLLM 서비스가 아직 시작되지 않았거나 모델 로딩 중인 것입니다. 잠시 기다린 후 다시 시도하세요. |

```bash
curl http://localhost:8001/v1/models
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | Qwen3-Coder 모델 서버(포트 8001)에 어떤 모델이 서빙되고 있는지 확인합니다. |
| **언제 사용하는지** | Qwen3-Coder 서비스가 정상적으로 시작되었는지 확인할 때 사용합니다. |

### 모델 테스트 (간단한 요청 보내기)

```bash
curl http://localhost:8000/v1/completions \
  -H "Content-Type: application/json" \
  -d '{"model": "/install_file_backup/tessinu/gpt-oss-120b", "prompt": "SELECT", "max_tokens": 50}'
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | GPT-OSS-120B 모델에 "SELECT"라는 프롬프트를 보내고, 최대 50토큰의 응답을 받습니다. |
| **언제 사용하는지** | 모델이 실제로 정상 동작하는지 확인하고 싶을 때 사용합니다. JSON 형태의 응답이 오면 정상입니다. |
| **주의사항** | `curl` 명령이 길어서 `\`(백슬래시)로 줄을 나누었습니다. 한 줄로 이어서 입력해도 됩니다. 응답이 올 때까지 수 초가 걸릴 수 있습니다. |

---

## 7. 방화벽 관리

> **방화벽이란?** 서버로 들어오는 네트워크 트래픽을 제어하는 보안 장치입니다.
> 특정 포트를 열어야 외부에서 해당 서비스에 접근할 수 있습니다.

### 현재 열린 포트 확인

```bash
firewall-cmd --list-ports
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | 방화벽에서 현재 외부 접근을 허용하고 있는 포트 목록을 보여줍니다. |
| **언제 사용하는지** | 특정 서비스에 외부에서 접근이 안 될 때, 해당 포트가 열려 있는지 확인하기 위해 사용합니다. |

### 새 포트 열기

```bash
sudo firewall-cmd --permanent --add-port=포트번호/tcp
sudo firewall-cmd --reload
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | 첫 번째 명령으로 방화벽 규칙에 새 포트를 영구적으로 추가하고, 두 번째 명령으로 변경 사항을 적용합니다. |
| **언제 사용하는지** | 새로운 서비스를 외부에서 접근 가능하게 해야 할 때 사용합니다. |
| **주의사항** | `--permanent` 옵션이 없으면 서버 재부팅 시 설정이 사라집니다. `--reload`를 해야 변경 사항이 즉시 적용됩니다. `포트번호` 부분을 실제 번호로 바꿔서 입력하세요 (예: `8080/tcp`). |

**예시: 포트 9090 열기**
```bash
sudo firewall-cmd --permanent --add-port=9090/tcp
sudo firewall-cmd --reload
firewall-cmd --list-ports   # 추가되었는지 확인
```

---

## 8. 서버에 파일 업로드/다운로드

> **SCP란?** SSH를 기반으로 파일을 안전하게 전송하는 명령어입니다.
> 아래 명령어들은 **Windows 터미널(PowerShell, CMD)에서** 실행하는 것입니다.
> (서버에 SSH로 접속한 상태가 아닌, 내 컴퓨터에서 실행)

### Windows에서 Linux 서버로 파일 업로드

```bash
scp "D:/Dev/Linux_LLM/app/파일명" root@192.168.10.40:/root/text2sql/파일명
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | 내 Windows PC의 파일을 Linux 서버로 복사합니다. |
| **언제 사용하는지** | 로컬에서 수정한 소스 코드나 설정 파일을 서버에 반영할 때 사용합니다. |
| **주의사항** | Windows 경로에 한글이나 공백이 있으면 반드시 큰따옴표(`"`)로 감싸세요. `파일명` 부분을 실제 파일 이름으로 바꿔서 사용하세요. |

**예시: config.py 파일 업로드**
```bash
scp "D:/Dev/Linux_LLM/app/config.py" root@192.168.10.40:/root/text2sql/app/config.py
```

### Linux 서버에서 Windows로 파일 다운로드

```bash
scp root@192.168.10.40:/root/text2sql/파일명 "D:/Dev/Linux_LLM/app/파일명"
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | Linux 서버의 파일을 내 Windows PC로 복사합니다. |
| **언제 사용하는지** | 서버의 로그 파일이나 설정 파일을 로컬로 가져와 확인하고 싶을 때 사용합니다. |
| **주의사항** | 순서가 `scp 원본(서버) 대상(로컬)` 입니다. 업로드와 반대 순서입니다. |

### 폴더 전체 업로드/다운로드

```bash
# 폴더 업로드 (Windows -> Linux)
scp -r "D:/Dev/Linux_LLM/app" root@192.168.10.40:/root/text2sql/app

# 폴더 다운로드 (Linux -> Windows)
scp -r root@192.168.10.40:/root/text2sql/app "D:/Dev/Linux_LLM/app"
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | `-r` 옵션을 추가하면 폴더 전체(하위 파일 포함)를 전송합니다. |
| **언제 사용하는지** | 여러 파일을 한꺼번에 전송해야 할 때 사용합니다. |
| **주의사항** | 같은 이름의 파일이 있으면 덮어씌웁니다. 중요한 파일은 미리 백업하세요. |

---

## 9. 시스템 리소스 확인

> 서버의 전반적인 상태(메모리, 디스크, CPU)를 점검하는 명령어들입니다.

### 메모리(RAM) 사용량 확인

```bash
free -h
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | 서버의 전체 메모리, 사용 중인 메모리, 남은 메모리를 사람이 읽기 쉬운 단위(GB, MB)로 보여줍니다. |
| **언제 사용하는지** | 서버가 느려졌을 때 메모리가 부족한지 확인하기 위해 사용합니다. |
| **주의사항** | `-h`는 "human-readable"의 약자로, 바이트 대신 GB/MB 단위로 보여줍니다. `available` 항목이 실제로 사용할 수 있는 메모리입니다. |

**출력 예시 읽는 법:**
```
              total    used    free    shared  buff/cache   available
Mem:          503Gi   480Gi   1.2Gi    12Mi      22Gi        20Gi
Swap:          16Gi     0Bi    16Gi
```
- **total**: 전체 메모리
- **used**: 사용 중인 메모리
- **available**: 실제로 사용 가능한 메모리 (이 값이 중요!)

### 디스크 사용량 확인

```bash
df -h
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | 서버의 디스크(저장공간) 사용량을 파티션별로 보여줍니다. |
| **언제 사용하는지** | 디스크가 가득 차서 파일 저장이 안 되거나, 모델 다운로드 공간이 필요할 때 확인합니다. |
| **주의사항** | `Use%`가 90% 이상이면 공간 확보가 필요합니다. `/` (루트) 파티션과 모델이 저장된 파티션을 특히 주의하세요. |

### CPU 사용률 실시간 확인

```bash
top
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | CPU 사용률, 프로세스 목록, 메모리 사용량 등을 실시간으로 보여줍니다. Windows의 작업 관리자와 비슷합니다. |
| **언제 사용하는지** | 서버가 느릴 때 어떤 프로세스가 CPU를 많이 사용하는지 확인할 때 사용합니다. |
| **주의사항** | **`q` 키를 눌러야 종료됩니다.** `Ctrl + C`로도 종료 가능합니다. |

---

## 10. 문제 해결 (트러블슈팅)

### 증상별 해결 방법

#### 웹 UI(http://192.168.10.40:7860)에 접속이 안 될 때

```bash
# 1단계: 서비스 상태 확인
systemctl status text2sql-ui

# 2단계: 서비스가 중지되어 있으면 시작
systemctl start text2sql-ui

# 3단계: 서비스가 실행 중인데도 안 되면 재시작
systemctl restart text2sql-ui

# 4단계: 그래도 안 되면 로그 확인
journalctl -u text2sql-ui -n 100 --no-pager
```

#### SQL 생성이 안 될 때 (모델 응답 없음)

```bash
# 1단계: vLLM 서비스 상태 확인
systemctl status vllm

# 2단계: 모델이 로딩되었는지 확인
curl http://localhost:8000/v1/models
# -> "Connection refused" 이면 아직 로딩 중이거나 서비스가 꺼져 있음

# 3단계: GPU 메모리 확인
nvidia-smi
# -> GPU 메모리가 비어 있으면 모델이 로딩되지 않은 것

# 4단계: vLLM 로그에서 오류 확인
journalctl -u vllm -n 100 --no-pager

# 5단계: 서비스 재시작 (최후의 수단)
systemctl restart vllm
# -> 모델 재로딩에 2~5분 소요
```

#### Qwen3-Coder 모델 응답이 없을 때

```bash
# 1단계: 서비스 상태 확인
systemctl status vllm-qwen3-coder

# 2단계: 모델 로딩 확인
curl http://localhost:8001/v1/models

# 3단계: 로그 확인
journalctl -u vllm-qwen3-coder -n 100 --no-pager

# 4단계: 서비스 재시작
systemctl restart vllm-qwen3-coder
```

#### 비밀번호를 변경했는데 적용이 안 될 때

```bash
# .env 파일이 정상적으로 수정되었는지 확인
cat /root/text2sql/.env

# 서비스 재시작 (이 단계를 빠뜨리면 변경사항이 적용되지 않음!)
systemctl restart text2sql-ui
```

#### 서버가 전체적으로 느릴 때

```bash
# GPU 상태 확인
nvidia-smi

# 메모리 확인
free -h

# CPU 확인
top
# (q 키로 종료)

# 디스크 확인
df -h
```

### 문제 해결 빠른 참고표

| 증상 | 확인 명령어 | 해결 방법 |
|------|-----------|-----------|
| 웹 UI 접속 불가 | `systemctl status text2sql-ui` | `systemctl restart text2sql-ui` |
| SQL 생성 안됨 | `systemctl status vllm` | `systemctl restart vllm` (재로딩 2~5분) |
| Qwen3 응답 없음 | `systemctl status vllm-qwen3-coder` | `systemctl restart vllm-qwen3-coder` |
| 모델 응답 없음 | `curl http://localhost:8000/v1/models` | vLLM 로그 확인 후 재시작 |
| GPU 메모리 부족 | `nvidia-smi` | 불필요한 프로세스 종료 또는 서비스 재시작 |
| 비밀번호 변경 안됨 | `cat /root/text2sql/.env` | `.env` 수정 후 `systemctl restart text2sql-ui` |
| 디스크 가득 참 | `df -h` | 불필요한 파일 삭제 또는 관리자에게 문의 |

---

## 11. 전체 시스템 재시작 순서

> **주의:** 서비스를 시작하는 순서가 중요합니다!
> vLLM(모델 서버)이 먼저 완전히 시작된 후에 웹 UI를 시작해야 합니다.
> 순서를 지키지 않으면 웹 UI가 모델에 연결하지 못해 오류가 발생합니다.

### 순서대로 실행

```bash
# ============================================
#  1단계: GPU 모델 서버 시작 (가장 먼저!)
# ============================================
systemctl start vllm
systemctl start vllm-qwen3-coder
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | GPT-OSS-120B와 Qwen3-Coder 모델 서빙 서비스를 시작합니다. |
| **주의사항** | 이 명령 후 모델이 GPU에 로딩되기까지 **약 2~5분**이 걸립니다. |

```bash
# ============================================
#  2단계: 모델 로딩 완료 대기 (약 2~5분)
# ============================================
# 아래 명령어로 모델 로딩이 완료되었는지 반복 확인하세요:
curl http://localhost:8000/v1/models
curl http://localhost:8001/v1/models
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | 모델이 정상적으로 로딩되었는지 확인합니다. |
| **주의사항** | 모델 목록이 JSON으로 반환되면 로딩 완료. "Connection refused"가 나오면 아직 로딩 중이므로 30초~1분 후 다시 시도하세요. |

```bash
# ============================================
#  3단계: 웹 UI 시작
# ============================================
systemctl start text2sql-ui
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | Gradio 웹 UI 서비스를 시작합니다. |
| **주의사항** | 반드시 2단계에서 모델 로딩이 완료된 것을 확인한 후 실행하세요. |

```bash
# ============================================
#  4단계: 전체 상태 확인
# ============================================
systemctl status vllm vllm-qwen3-coder text2sql-ui
```

| 항목 | 설명 |
|------|------|
| **무엇을 하는 명령인지** | 세 개의 서비스가 모두 정상적으로 실행 중인지 한번에 확인합니다. |
| **주의사항** | 세 서비스 모두 `Active: active (running)` 상태여야 정상입니다. |

### 전체 시스템 재시작 한눈에 보기

```
[1] systemctl start vllm              # GPT-OSS 모델 서버 시작
[1] systemctl start vllm-qwen3-coder  # Qwen3-Coder 모델 서버 시작
          |
          | (2~5분 대기 - 모델 로딩)
          |
[2] curl http://localhost:8000/v1/models   # 로딩 확인
[2] curl http://localhost:8001/v1/models   # 로딩 확인
          |
          | (JSON 응답 확인 후)
          |
[3] systemctl start text2sql-ui       # 웹 UI 시작
          |
[4] systemctl status vllm vllm-qwen3-coder text2sql-ui  # 전체 확인
```

---

## 부록: 자주 쓰는 Linux 기본 명령어

> 서버에서 자주 사용하는 기본 명령어 모음입니다.

| 명령어 | 설명 | 예시 |
|--------|------|------|
| `ls` | 현재 폴더의 파일 목록 보기 | `ls /root/text2sql/` |
| `ls -la` | 파일 목록을 상세하게 보기 (숨김 파일 포함) | `ls -la /root/text2sql/` |
| `cd` | 폴더 이동 | `cd /root/text2sql/app` |
| `pwd` | 현재 내가 어디 있는지 (경로) 확인 | `pwd` |
| `mkdir` | 새 폴더 만들기 | `mkdir /root/backup` |
| `cp` | 파일 복사 | `cp config.py config.py.bak` |
| `mv` | 파일 이동 또는 이름 변경 | `mv old.py new.py` |
| `rm` | 파일 삭제 (**주의: 복구 불가!**) | `rm 파일명` |
| `rm -rf` | 폴더 전체 삭제 (**매우 주의!**) | `rm -rf 폴더명` |
| `tail -f` | 파일 끝부분을 실시간으로 모니터링 | `tail -f /var/log/messages` |
| `grep` | 파일에서 특정 텍스트 검색 | `grep "error" logfile.txt` |
| `history` | 이전에 실행한 명령어 기록 보기 | `history` |
| `clear` | 터미널 화면 지우기 | `clear` |
| `reboot` | 서버 재부팅 (**최후의 수단!**) | `reboot` |

> **경고:** `rm -rf`와 `reboot`는 매우 신중하게 사용해야 합니다.
> 특히 `rm -rf /`는 절대로 실행하지 마세요. 서버의 모든 데이터가 삭제됩니다.

---

*이 문서는 2026-02-20에 작성되었습니다.*
*문서에 대한 문의나 수정 요청은 서버 관리자에게 연락하세요.*
